# 其他API

## 重启 OneBot 实现

- `set_restart`

::: details 点击查看请求示例数据

```json
{
  "delay": 0
}
```

:::

### 参数

| 字段名  | 数据类型 | 默认值 | 说明                                                                 |
| ------- | -------- | ------ | -------------------------------------------------------------------- |
| `delay` | number   | `0`    | 要延迟的毫秒数，如果默认情况下无法重启，可以尝试设置延迟为 2000 左右 |

### 响应数据

无

## 清理缓存

- `clean_cache`

### 参数

无

### 响应数据

无

## 图片 OCR

- `ocr_image` (gocq拓展)
- `.ocr_image` (gocq拓展)

::: details 点击查看请求示例数据

```json
{
  "image": "image.jpg"
}
```

:::

::: details 点击查看响应示例数据

```json
{
  "texts": [
    {
      "text": "识别出的文本",
      "confidence": 100,
      "coordinates": [
        {
          "x": 0,
          "y": 0
        }
      ]
    }
  ],
  "language": "zh_CN"
}
```

:::

::: details 点击查看 NapCat 响应示例数据

```json
[
  {
    "text": "nU",
    "pt1": {
      "x": "25.930853",
      "y": "1.711797"
    },
    "pt2": {
      "x": "72.461205",
      "y": "2.745806"
    },
    "pt3": {
      "x": "72.193184",
      "y": "14.806514"
    },
    "pt4": {
      "x": "25.662836",
      "y": "13.772506"
    },
    "charBox": [
      {
        "charText": "nU",
        "charBox": {
          "pt1": {
            "x": "41.186707",
            "y": "2.050816"
          },
          "pt2": {
            "x": "56.442558",
            "y": "2.389835"
          },
          "pt3": {
            "x": "56.182915",
            "y": "14.073647"
          },
          "pt4": {
            "x": "40.927063",
            "y": "13.734628"
          }
        }
      }
    ],
    "score": ""
  },
  {
    "text": "yion in",
    "pt1": {
      "x": "40.310081",
      "y": "19.155090"
    },
    "pt2": {
      "x": "92.413017",
      "y": "17.004047"
    },
    "pt3": {
      "x": "93.224297",
      "y": "36.654957"
    },
    "pt4": {
      "x": "41.121365",
      "y": "38.806000"
    },
    "charBox": [
      {
        "charText": "yion",
        "charBox": {
          "pt1": {
            "x": "40.310081",
            "y": "19.155090"
          },
          "pt2": {
            "x": "66.660988",
            "y": "18.067207"
          },
          "pt3": {
            "x": "67.446922",
            "y": "37.104027"
          },
          "pt4": {
            "x": "41.096012",
            "y": "38.191910"
          }
        }
      },
      {
        "charText": " ",
        "charBox": {
          "pt1": {
            "x": "66.660988",
            "y": "18.067207"
          },
          "pt2": {
            "x": "73.847603",
            "y": "17.770512"
          },
          "pt3": {
            "x": "74.633530",
            "y": "36.807331"
          },
          "pt4": {
            "x": "67.446922",
            "y": "37.104027"
          }
        }
      },
      {
        "charText": "in",
        "charBox": {
          "pt1": {
            "x": "73.847603",
            "y": "17.770512"
          },
          "pt2": {
            "x": "85.825287",
            "y": "17.276018"
          },
          "pt3": {
            "x": "86.611214",
            "y": "36.312836"
          },
          "pt4": {
            "x": "74.633530",
            "y": "36.807331"
          }
        }
      }
    ],
    "score": ""
  },
  {
    "text": "mlHttp.",
    "pt1": {
      "x": "6.956338",
      "y": "61.610126"
    },
    "pt2": {
      "x": "72.331848",
      "y": "65.844292"
    },
    "pt3": {
      "x": "71.104248",
      "y": "84.798470"
    },
    "pt4": {
      "x": "5.728738",
      "y": "80.564301"
    },
    "charBox": [
      {
        "charText": "mlHttp",
        "charBox": {
          "pt1": {
            "x": "9.230268",
            "y": "61.757401"
          },
          "pt2": {
            "x": "61.530674",
            "y": "65.144737"
          },
          "pt3": {
            "x": "60.341438",
            "y": "83.506592"
          },
          "pt4": {
            "x": "8.041031",
            "y": "80.119255"
          }
        }
      },
      {
        "charText": ".",
        "charBox": {
          "pt1": {
            "x": "63.804607",
            "y": "65.292007"
          },
          "pt2": {
            "x": "70.626396",
            "y": "65.733833"
          },
          "pt3": {
            "x": "69.437164",
            "y": "84.095695"
          },
          "pt4": {
            "x": "62.615368",
            "y": "83.653870"
          }
        }
      }
    ],
    "score": ""
  }
]
```

:::

### 参数

| 字段名  | 数据类型 | 默认值 | 说明                                   |
| ------- | -------- | ------ | -------------------------------------- |
| `image` | string   | -      | 图片ID，格式同图片消息段的 `file` 参数 |

### 响应数据

| 字段名     | 数据类型        | 说明    |
| ---------- | --------------- | ------- |
| `texts`    | TextDetection[] | OCR结果 |
| `language` | string          | 语言    |

**TextDetection**

| 字段名        | 数据类型       | 说明   |
| ------------- | -------------- | ------ |
| `text`        | string         | 文本   |
| `confidence`  | number (int32) | 置信度 |
| `coordinates` | vector2[]      | 坐标   |

- `NapCat`
  - 经测试，在 `Linux` 上无法使用此功能
  - 返回参数请参考上方 `NapCat` 响应示例数据

## 下载文件到缓存目录

- `download_file` (gocq拓展)

::: details 点击查看请求示例数据

```json
{
  "url": "http://example.com/file.jpg",
  "thread_count": 1,
  "headers": [
    "User-Agent: Mozilla/5.0"
  ]
}
```

:::

::: details 点击查看 NapCat 请求示例数据

```json
{
  "url": "http://example.com/file.jpg",
  "base64": "base64",
  "name": "file.jpg",
  "headers": [
    "User-Agent: Mozilla/5.0"
  ]
}
```

::: details 点击查看响应示例数据

```json
{
  "file": "D:/CQP/data/download/file.jpg"
}
```

:::

### 参数

| 字段名         | 数据类型        | 默认值 | 说明         |
| -------------- | --------------- | ------ | ------------ |
| `url`          | string          | -      | 链接地址     |
| `thread_count` | number (int32)  | `1`    | 下载线程数   |
| `headers`      | string 或 array | -      | 自定义请求头 |

**`headers`格式:**

字符串:

```
User-Agent=YOUR_UA[\r\n]Referer=https://www.baidu.com
```

::: tip 提示
`[\r\n]` 为换行符, 使用http请求时请注意编码
:::

JSON数组:

```json
[
    "User-Agent=YOUR_UA",
    "Referer=https://www.baidu.com"
]
```

- `NapCat`

| 字段名    | 数据类型        | 默认值 | 说明                        |
| --------- | --------------- | ------ | --------------------------- |
| `url`     | string          | -      | 链接地址 与 `base64` 二选一 |
| `base64`  | string          | -      | 图片base64 与 `url` 二选一  |
| `name`    | string          | -      | 自定义文件名称              |
| `headers` | string 或 array | -      | 自定义请求头                |

### 响应数据

| 字段名 | 数据类型 | 说明             |
| ------ | -------- | ---------------- |
| `file` | string   | 下载后的文件路径 |

## 检查链接安全性

- `check_url_safely` (gocq拓展)

::: details 点击查看请求示例数据

```json
{
  "url": "http://example.com"
}
```

:::

::: details 点击查看响应示例数据

```json
{
  "level": 1
}
```

:::

### 参数

| 字段名 | 数据类型 | 默认值 | 说明           |
| ------ | -------- | ------ | -------------- |
| `url`  | string   | -      | 需要检查的链接 |

### 响应数据

| 字段名  | 数据类型 | 说明                           |
| ------- | -------- | ------------------------------ |
| `level` | number   | 安全等级，1:安全 2:未知 3:危险 |

## 对事件执行快速操作

- `.handle_quick_operation`

::: details 点击查看请求示例数据

```json
{
  "context": {
    "message_id": 123456789,
    "user_id": 987654321,
    "message": "Hello World",
    "raw_message": "Hello World"
  },
  "operation": {
    "reply": "你好",
    "auto_escape": false
  }
}
```

:::

### 参数

| 字段名      | 数据类型 | 默认值 | 说明                                               |
| ----------- | -------- | ------ | -------------------------------------------------- |
| `context`   | object   | -      | 事件数据对象，可做精简，如去掉原始消息只保留消息id |
| `operation` | object   | -      | 快速操作对象，例如 `{"reply": "回复内容"}`         |

### 响应数据

无

## 获取中文分词

- `.get_word_slices` (gocq拓展)

::: details 点击查看请求示例数据

```json
{
  "content": "中文分词测试"
}
```

:::

::: details 点击查看响应示例数据

```json
{
  "slices": [
    "中文",
    "分词",
    "测试"
  ]
}
```

:::

### 参数

| 字段名    | 数据类型 | 默认值 | 说明 |
| --------- | -------- | ------ | ---- |
| `content` | string   | -      | 内容 |

### 响应数据

| 字段名   | 数据类型 | 说明     |
| -------- | -------- | -------- |
| `slices` | string[] | 分词结果 |